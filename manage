// https://developer.algorand.org/docs/run-a-node/setup/install/#sync-node-network-using-fast-catchup

// set env vars for terminal
export ALGORAND_DATA="$HOME/node/testnetdata"
export WALLET=2i2i
export CODE_DIR=./code
export TXNS_DIR=./txns
export SYSTEM_APPROVAL_FILE=$CODE_DIR/state_approval_program.teal
export SYSTEM_CLEAR_FILE=$CODE_DIR/state_clear_program.teal
export CREATOR=2I2IXTP67KSNJ5FQXHUJP5WZBX2JTFYEBVTBYFF3UUJ3SQKXSZ3QHZNNPY
export SYSTEM_ID=92065044
export SYSTEM_ACCOUNT=D5CHP2N2ZH4DW7MJIJT3AXIIV2XYCCZHP5CZJIWRPENDEEBPV53CTELJ64
export N=3
export ASA=91697272
export A=NVVMVMEFGTLIVW3YL6R7ADZAWU66HUBNHI6OH264U5YKVZVPG67EMB5EWM

goal app create --creator $CREATOR --approval-prog $SYSTEM_APPROVAL_FILE --clear-prog $SYSTEM_CLEAR_FILE --global-byteslices $N --global-ints $(($N+1)) --local-byteslices 0 --local-ints 0 --extra-pages 0 --on-completion OptIn -w $WALLET
goal app info --app-id $SYSTEM_ID

goal asset create --creator $CREATOR --total 1000000000 --unitname NOVALUE --decimals 0 -w $WALLET
goal app optin --app-id $SYSTEM_ID --from $A -w $WALLET
goal asset send -a 0 --assetid $ASA -f $SYSTEM_ACCOUNT -t $SYSTEM_ACCOUNT -w $WALLET
goal app delete --app-id $SYSTEM_ID --from $CREATOR

goal app update --app-id=$SYSTEM_ID --from=$CREATOR --approval-prog $SYSTEM_APPROVAL_FILE --clear-prog $SYSTEM_CLEAR_FILE -w $WALLET

// optin
goal app call --from=$CREATOR --app-id=$SYSTEM_ID --foreign-asset $ASA --app-arg="str:optin" --app-arg="int:$ASA" -w $WALLET --out=$TXNS_DIR/optin.stxn
goal clerk dryrun -t $TXNS_DIR/optin.stxn --dryrun-dump -o $TXNS_DIR/optin_dryrun.json
tealdbg debug $SYSTEM_APPROVAL_FILE -d $TXNS_DIR/optin_dryrun.json

// update
goal app call --from=$CREATOR --app-id=$SYSTEM_ID --app-arg="str:update" --app-arg="str:0" --app-arg="int:4000" --app-arg="str:$ASA" --app-arg="int:3000" --app-arg="str:23" --app-arg="int:3000" -w $WALLET
goal app call --from=$CREATOR --app-id=$SYSTEM_ID --app-arg="str:update" --app-arg="str:0" --app-arg="int:5000" --app-arg="str:$ASA" --app-arg="int:5000" -w $WALLET --out=$TXNS_DIR/update.stxn
goal clerk dryrun -t $TXNS_DIR/update.stxn --dryrun-dump -o $TXNS_DIR/update_dryrun.json
tealdbg debug $SYSTEM_APPROVAL_FILE -d $TXNS_DIR/update_dryrun.json

// swap
chrome://inspect/#devices
goal clerk send --from=$A --to=$SYSTEM_ACCOUNT --amount=1 --out=$TXNS_DIR/send.txn -w $WALLET
goal app call --from=$A --app-id=$SYSTEM_ID --app-arg="str:swap" --out=$TXNS_DIR/state.txn -w $WALLET
cat $TXNS_DIR/send.txn $TXNS_DIR/state.txn > $TXNS_DIR/combinedtransactions.txn
goal clerk group --infile $TXNS_DIR/combinedtransactions.txn --outfile $TXNS_DIR/groupedtransactions.txn
goal clerk sign --infile $TXNS_DIR/groupedtransactions.txn --outfile $TXNS_DIR/swap.stxn
goal clerk dryrun -t $TXNS_DIR/swap.stxn --dryrun-dump -o $TXNS_DIR/dr.json
tealdbg debug $SYSTEM_APPROVAL_FILE -d $TXNS_DIR/dr.json --group-index 1

// read
goal app read --app-id=$SYSTEM_ID --global